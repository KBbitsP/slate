# Tenant

## Tenant Resource

Kill Bill has been designed from the ground up as a multi-tenant system, that is, one where multiple unrelated deployments can be hosted on the same physical system. Each deployment has its own separate configuration, catalog, and plugins, and of course its data set is kept entirely separate from the others. RBAC control allows different users/admin/apps to access zero, one or multiple tenants. This [blog](http://killbill.io/blog/subscription-service-using-kill-bill/) illustrates some interesting use cases. The `Tenant` resource allows the management of such tenants.

The attributes of the `Tenant` resource object are the following:

| Name | Type | Generated by | Description |
| ---- | -----| -------- | ------------ |
| **tenantId** | string | system | UUID for this tenant |
| **externalKey** | string | system or user | Optional external key provided by the client |
| **apiKey** | string | user | The api key associated with the tenant |
| **apiSecret** | string | user | The api secret associated with the tenant. This value is hashed and cannot be retrieved. |
| **auditLogs** | array | system | Array of audit log records for this tenant |

Note that The tenant itself has very few attributes, as most attributes belong to the individual accounts and related resources.

## Tenant

These endpoints manage information that is maintained at the tenant level. Unless otherwise stated, the tenant is identified by its API key in the header.

### Create a tenant

This API creates a new tenant.

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/tenants`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "Content-Type: application/json" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d '{ "apiKey": "bob", "apiSecret": "lazar"}' \
    "http://127.0.0.1:8080/1.0/kb/tenants"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

UUID tenantId = null;
String externalKey = null;
String apiKey = bob;
String apiSecret = lazar;

Tenant body = new Tenant(tenantId,
                         externalKey,
                         apiKey,
                         apiSecret);
                         
tenantApi.createTenant(body, requestOptions)
```

```ruby
tenant = KillBillClient::Model::Tenant.new
tenant.external_key = "demo_external_key"
tenant.api_key = "demo_api_key"
tenant.api_secret = "demo_api_secret"

use_global_defalut = true
user = "demo"
reason = nil
comment = nil

tenant.create(use_global_defalut, 
              user, 
              reason, 
              comment, 
              options)
```

```python
tenantApi = killbill.api.TenantApi()

body = Tenant(api_key='demo_api_key', api_secret='demo_api_secret')

tenantApi.create_tenant(body, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/e7b03c81-f41a-4eb7-a645-b9166057f186
< Content-Type: application/json
< Content-Length: 0
```
```java
class Tenant {
    tenantId: 5cce926f-7f3a-4007-a5a0-e5b55fc50079
    externalKey: null
    apiKey: bob
    apiSecret: lazar
    auditLogs: []
}
```
```ruby
{
   "tenantId":"ab5981c2-de14-43d6-a35b-a2ed0b28c746",
   "externalKey":"demo_external_key",
   "apiKey":"bob
}
```
```python
no content
```
**Request Body**

A JSON string representing a Tenant resource. The only paramaters required are `apiKey` and `apiSecret`. The `externalKey` is optional and will be set to null if not supplied. The `tenantId` and the audit logs are generated by the system.

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **useGlobalDefault** | boolean | false | false | If true, configure the tenant with a default catalog |

Setting the `useGlobalDefault` parameter to `true` can be used for test purposes. This will configure the tenant with a default catalog, and therefore make it easy to quickly start playing with the apis. Note that in order to then upload a new custom catalog, one would need to [invalidate the caches for this tenant](#admin-invalidates-caches-per-tenant-level).

**Response**

If successful, returns a status code of 201 and an empty body. In addition a `Location` parameter is returned in the header. This parameter gives the URL for the tenant, including the `tenantId`.

### Retrieve a tenant by id

Retrieves a tenant resource, given its ID.

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/{tenantId}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/tenants/6907712e-e940-4033-8695-36894db128d3"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

UUID tenantId = UUID.fromString("6907712e-e940-4033-8695-36894db128d3");
tenantApi.getTenant(tenantId, requestOptions);
```

```ruby
tenant_id = "ab5981c2-de14-43d6-a35b-a2ed0b28c746"

KillBillClient::Model::Tenant.find_by_id(tenant_id, options)
```

```python
tenantApi = killbill.api.TenantApi()

tenant.get_tenant(tenant_id='3d90ec45-c640-4fd7-abde-798bc582513b')
```

> Example Response:

```shell
{
  "tenantId": "6907712e-e940-4033-8695-36894db128d3",
  "externalKey": "1532546166-326384",
  "apiKey": "bob",
  "apiSecret": null,
  "auditLogs": []
}
```
```java
class Tenant {
  "tenantId": "6907712e-e940-4033-8695-36894db128d3",
  "externalKey": "1532546166-326384",
  "apiKey": "bob",
  "apiSecret": null,
  "auditLogs": []
}
```
```ruby
{
   "tenantId":"ab5981c2-de14-43d6-a35b-a2ed0b28c746",
   "externalKey":"demo_external_key",
   "apiKey":"bob"
}
```
```python
{'api_key': 'udwg',
 'api_secret': None,
 'audit_logs': [],
 'external_key': None,
 'tenant_id': '3d90ec45-c640-4fd7-abde-798bc582513b'}
```

**Query Parameters**

none

**Response**

If successful, returns a status code of 200 and a tenant resource object.  The `apiSecret` attribute is returned as `null`, since it cannot be retrieved.

### Retrieve a tenant by its API key

Retrieves a tenant resource, given its `apiKey`. The `apiKey` is passed as a query parameter.

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/tenants?apiKey=bob"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String apiKey = "bob";

tenantApi.getTenantByApiKey(apiKey, requestOptions);
```

```ruby
api_key = "demo_api_key"

KillBillClient::Model::Tenant.find_by_api_key(api_key, options)
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.get_tenant_by_api_key(api_key='bob')
```

> Example Response:

```shell
{
  "tenantId": "6907712e-e940-4033-8695-36894db128d3",
  "externalKey": "1532546166-326384",
  "apiKey": "bob",
  "apiSecret": null,
  "auditLogs": []
}
```
```java
{
  "tenantId": "6907712e-e940-4033-8695-36894db128d3",
  "externalKey": "1532546166-326384",
  "apiKey": "bob",
  "apiSecret": null,
  "auditLogs": []
}
```
```ruby
{
   "tenantId":"ab5981c2-de14-43d6-a35b-a2ed0b28c746",
   "externalKey":"demo_external_key",
   "apiKey":"bob"
}
```
```python
{'api_key': 'bob',
 'api_secret': None,
 'audit_logs': [],
 'external_key': None,
 'tenant_id': '3d90ec45-c640-4fd7-abde-798bc582513b'}
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **apiKey** | string | true | none | api key |

**Response**

If successful, returns a status code of 200 and a tenant resource object.  The `apiSecret` attribute is returned as `null`, since it cannot be retrieved.

## Push Notifications

Push notifications are a convenient way to get notified about events from the system.
One can register a callback, i.e, a valid URL that will be called whenever there is an event dispatched for this tenant.
Note that this can result in a large number of calls; every time there is a state change for one of the `Accounts`
in this tenant, the callback will be invoked.

In case of error, the system will retry the callback as defined by the system property `org.killbill.billing.server.notifications.retries`.

See push notification documentation [here](http://docs.killbill.io/latest/push_notifications.html) for further information.

### Register a push notification

Register a callback URL for this tenant for push notifications.

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    'http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback?cb=http://demo/callmeback'
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String cb = "http://demo/callmeback";

TenantKeyValue result = tenantApi.registerPushNotificationCallback(cb, requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.register_push_notification_callback(created_by='demo', cb='http://demo/callmeback')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/registerNotificationCallback
< Content-Type: application/json
< Content-Length: 0
```
```java
class TenantKeyValue {
    key: PUSH_NOTIFICATION_CB
    values: [http://demo/callmeback]
}
```
```ruby
TODO
```
```python
no content
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **cb** | string | true | none | callback URL to register |

**Response**

If successful, returns a status code of 201 and an empty body.

### Retrieve a registered push notification

Gets the push notification registered for this tenant, if any.

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/registerNotificationCallback"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

TenantKeyValue result = tenantApi.getPushNotificationCallbacks(requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.get_push_notification_callbacks()
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "PUSH_NOTIFICATION_CB",
  "values": [
    "http://demo/callmeback"
  ]
}
```
```java
class TenantKeyValue {
    key: PUSH_NOTIFICATION_CB
    values: [http://demo/callmeback]
}
```
```ruby
TODO
```
```python
{'key': 'PUSH_NOTIFICATION_CB', 'values': ['http://demo/callmeback']}
```

**Query Parameters**

None.

**Response**

If successful, returns a status code of 200 and a body containing a key-value object as follows:

{
  "key": "PUSH_NOTIFICATION_CB",
  "values": list containing the callback URL, if any
}

### Delete a registered push notification

Deletes the registered callback URL, if any.

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

tenantApi.deletePushNotificationCallbacks(requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.delete_push_notification_callbacks(created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
```
```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None.

**Response**

If successful, returns a status code of 204 and an empty body.

## Configuration

Please refer to our [configuartion guide](http://docs.killbill.io/latest/userguide_configuration.html) to see what can be configured in the system.
Some of the configuration can be overriden at the tenant level to allow for different behaviors. The endpoints below allow setting the available per-tenant properties.

### Add a per tenant system properties configuration

This API is used to set the value of specific system properties, overriding the system-wide values.

For example, in order to disable the invoice safety bound mechanism on a per-tenant level, this API could be used to set the per-tenant system property `org.killbill.invoice.sanitySafetyBoundEnabled` to false.

The API sets the value of the "PER_TENANT_CONFIG" key, replacing any previous value.


**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig`


> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: text/plain" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d "{"org.killbill.invoice.sanitySafetyBoundEnabled":"false"}" \
    "http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String body = "{"org.killbill.invoice.sanitySafetyBoundEnabled":"false"}";

TenantKeyValue result = tenantApi.uploadPerTenantConfiguration(body, requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()
body = '{"org.killbill.invoice.sanitySafetyBoundEnabled":"false"}'

tenantApi.upload_per_tenant_configuration(body, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/uploadPerTenantConfig
< Content-Type: application/json
< Content-Length: 0
```
```java
class TenantKeyValue {
    key: PER_TENANT_CONFIG
    values: [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]
}
```
```ruby
TODO
```
```python
no content
```

**Query Parameters**

None.

**Response**

If successful, returns a status code of 201 and an empty body.

### Retrieve a per tenant system properties configuration

Retrieves the content of the per tenant system properties configuration key ("PER_TENANT_CONFIG")

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/uploadPerTenantConfig"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

TenantKeyValue result = tenantApi.getPerTenantConfiguration(requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.get_per_tenant_configuration()
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "PER_TENANT_CONFIG",
  "values": [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]
}
```
```java
class TenantKeyValue {
    key: PER_TENANT_CONFIG
    values: [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]
}
```
```ruby
TODO
```
```python
{'key': 'PER_TENANT_CONFIG', 'values': [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]}
```

**Query Parameters**

None.

**Returns**

If successful, returns a status code of 200 and a tenant key value object.

### Retrieve a per tenant key value based on key prefix

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig/{keyPrefix}/search`

The search api allows to search for existing keys based on prefix. So, for instance we can use the prefix `PER_TENANT` and expect
to see the result for our previous key `PER_TENANT_CONFIG`.

> Example Request:



```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/uploadPerTenantConfig/PER_TENANT/search"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String keyPrefix = "PER_TENANT";

TenantKeyValue result = tenantApi.getAllPluginConfiguration(keyPrefix, requestOptions);
```

```ruby
key_prefix = "PER_TENANT"

KillBillClient::Model::Tenant.search_tenant_config(key_prefix, options)
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.get_all_plugin_configuration(key_prefix='tenant_config')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "PER_TENANT_CONFIG",
  "values": [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]
}
```
```java
class TenantKeyValue {
    key: PER_TENANT_CONFIG
    values: [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]
}
```
```ruby
TODO
```
```python
{'key': 'PER_TENANT_CONFIG', 'values': [
    "{org.killbill.invoice.sanitySafetyBoundEnabled:false}"
  ]}
```

**Query Parameters**

None.

**Returns**

Returns a tenant key value object.

### Delete a per tenant configuration (system properties)

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://localhost:8080/1.0/kb/tenants/uploadPerTenantConfig"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

tenantApi.deletePerTenantConfiguration(requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

tenantApi.delete_per_tenant_configuration(created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
```
```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 204 http status without content.


## Plugin Configuration

Plugins also support configuration on a per-tenant level. Please refer to our plugin [configuration manual](http://docs.killbill.io/0.20/plugin_development.html#_plugin_configuration) for more details.

An example for using such per-tenant properties is to to configure a payment plugin with different api keys,
one set of keys for each tenant. This allows for a true multi-tenant deployment where plugins have different configuration
based on the tenant in which they operate.

Upon adding/deleting new per-tenant plugin configuration, the system will generate a `TENANT_CONFIG_CHANGE`/`TENANT_CONFIG_DELETION` event, and such event can be handled in the plugin to refresh its configuration. In multi-node scenarios, events will be dispatched on each node, that is, on each plugin instance so they end up with a consistent view. A lot of the logic to handle configuration update has been implemented in our plugin frameworks, see [ruby framework](https://github.com/killbill/killbill-plugin-framework-ruby) and [java framework](https://github.com/killbill/killbill-plugin-framework-java).


The following endpoints provide the ability to configure plugins on a per-tenant level.

### Add a per tenant configuration for a plugin

**HTTP Request** 



`POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}`

The configuration uploaded is plugin dependent but typically we see key/value properties,
or well formatted yml.


> Example Request:


```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: text/plain" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d @./config.properties \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String pluginName = "PLUGIN_FOO";
String pluginConfig = getResourceBodyString("plugin.yml");

TenantKeyValue result = tenantApi.uploadPluginConfiguration(pluginName, pluginConfig, requestOptions);
```

```ruby
plugin_name = "demo_plugin"
plugin_config = "tenant_config"
user = "demo"
reason = nil
comment = nil

KillBillClient::Model::Tenant.upload_tenant_plugin_config(plugin_name, 
                                                          plugin_config, 
                                                          user, 
                                                          reason, 
                                                          comment, 
                                                          options)
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'
body = 'tenant_config'

tenantApi.upload_plugin_configuration(plugin_name, body, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/uploadPluginConfig/demo_plugin
< Content-Type: application/json
< Content-Length: 0
```
```java
class TenantKeyValue {
    key: PLUGIN_CONFIG_PLUGIN_FOO
    values: 
    
    :my_plugin:
      :test: True
      :log_file: /var/tmp/myplugin.log
      :username: xx
      :password: yoyoyo
      :merchant_id:
        :USD: '0689870'
    
    :database:
      :adapter: sqlite3
      :database: test.db
    
    ]
}
```
```ruby
{
   "key":"PLUGIN_CONFIG_demo_plugin",
   "values":[
      "tenant_config"
   ]
}
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 201 http status without content.

### Retrieve a per tenant configuration for a plugin

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

final String pluginName = "PLUGIN_FOO";

final TenantKeyValue result = tenantApi.getPluginConfiguration(pluginName, requestOptions);
```

```ruby
plugin_name = "demo_plugin"

KillBillClient::Model::Tenant.get_tenant_plugin_config(plugin_name, options)
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'

tenantApi.get_plugin_configuration(plugin_name)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "PLUGIN_CONFIG_demo_plugin",
  "values": [
    "tenant_config"
  ]
}
```
```java
class TenantKeyValue {
    key: PLUGIN_CONFIG_PLUGIN_FOO
    values: 
    
    :my_plugin:
      :test: True
      :log_file: /var/tmp/myplugin.log
      :username: xx
      :password: yoyoyo
      :merchant_id:
        :USD: '0689870'
    
    :database:
      :adapter: sqlite3
      :database: test.db
    
    ]
}
```
```ruby
{
   "key":"PLUGIN_CONFIG_demo_plugin",
   "values":[
      "tenant_config"
   ]
}
```
```python
{'key': 'PLUGIN_CONFIG_demo_plugin', 'values': []}
```

**Query Parameters**

None.

**Returns**

Returns a tenant key value object.

### Delete a per tenant configuration for a plugin

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

final String pluginName = "PLUGIN_FOO";

tenantApi.deletePluginConfiguration(pluginName, requestOptions);
```

```ruby
user = "demo"
reason = nil
comment = nil

plugin_name = "demo_plugin"

KillBillClient::Model::Tenant.delete_tenant_plugin_config(plugin_name, 
                                                          user, 
                                                          reason, 
                                                          comment, 
                                                          options)
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'

tenantApi.delete_plugin_configuration(plugin_name, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
```
```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 204 http status without content.

## Payment State Machines

This is a somewhat advanced use case to override the default internal payment state machine within Kill Bill. Please refer to our [payment manual](http://docs.killbill.io/0.20/userguide_payment.html#_payment_states) for more details about payment states.

The endpoints below allow to override such state machine on a per-tenant level.

### Add a per tenant payment state machine for a plugin

**HTTP Request** 

Let's say we want to overwite the default Kill Bill payment state machine for the payment plugin `demo_plugin`, and assuming
a valid payment state machine xml file in `SimplePaymentStates.xml`.

`POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: text/plain" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
	-d '@SimplePaymentStates.xml' \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String pluginName = "noop";
String stateMachineConfig = getResourceBodyString("SimplePaymentStates.xml");

TenantKeyValue result = tenantApi.uploadPluginPaymentStateMachineConfig(pluginName, 
                                                                        stateMachineConfig, 
                                                                        requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'
body = 'SimplePaymentStates.xml'

tenantApi.upload_plugin_payment_state_machine_config(plugin_name, body, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/demo_plugin
< Content-Type: application/json
< Content-Length: 0
```
```java
class TenantKeyValue {
    key: PLUGIN_PAYMENT_STATE_MACHINE_noop
    values: [<?xml version="1.0" encoding="UTF-8"?>
   
    
    <stateMachineConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:noNamespaceSchemaLocation="StateMachineConfig.xsd">
    
        <stateMachines>
            <stateMachine name="BIG_BANG">
                <states>
                    <state name="BIG_BANG_INIT"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>BIG_BANG_INIT</initialState>
                        <operation>OP_DUMMY</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>BIG_BANG_INIT</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_DUMMY"/>
                </operations>
            </stateMachine>
            <stateMachine name="AUTHORIZE">
                <states>
                    <state name="AUTH_INIT"/>
                    <state name="AUTH_SUCCESS"/>
                    <state name="AUTH_FAILED"/>
                    <state name="AUTH_ERRORED"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>AUTH_SUCCESS</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>FAILURE</operationResult>
                        <finalState>AUTH_FAILED</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>EXCEPTION</operationResult>
                        <finalState>AUTH_ERRORED</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_AUTHORIZE"/>
                </operations>
            </stateMachine>
        </stateMachines>
    
        <linkStateMachines>
            <linkStateMachine>
                <initialStateMachine>BIG_BANG</initialStateMachine>
                <initialState>BIG_BANG_INIT</initialState>
                <finalStateMachine>AUTHORIZE</finalStateMachine>
                <finalState>AUTH_INIT</finalState>
            </linkStateMachine>
        </linkStateMachines>
    </stateMachineConfig>
    ]
}
```
```ruby
TODO
```
```python
no content
```

**Query Parameters**

None. 

**Returns**

A 201 http status without content.

### Retrieve a per tenant payment state machine for a plugin

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String pluginName = "noop";

TenantKeyValue result = tenantApi.getPluginPaymentStateMachineConfig(pluginName, requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'

tenantApi.get_plugin_payment_state_machine_config(plugin_name)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "PLUGIN_PAYMENT_STATE_MACHINE_demo_plugin",
  "values": [<?xml version="1.0" encoding="UTF-8"?>
    
    <stateMachineConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:noNamespaceSchemaLocation="StateMachineConfig.xsd">
    
        <stateMachines>
            <stateMachine name="BIG_BANG">
                <states>
                    <state name="BIG_BANG_INIT"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>BIG_BANG_INIT</initialState>
                        <operation>OP_DUMMY</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>BIG_BANG_INIT</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_DUMMY"/>
                </operations>
            </stateMachine>
            <stateMachine name="AUTHORIZE">
                <states>
                    <state name="AUTH_INIT"/>
                    <state name="AUTH_SUCCESS"/>
                    <state name="AUTH_FAILED"/>
                    <state name="AUTH_ERRORED"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>AUTH_SUCCESS</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>FAILURE</operationResult>
                        <finalState>AUTH_FAILED</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>EXCEPTION</operationResult>
                        <finalState>AUTH_ERRORED</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_AUTHORIZE"/>
                </operations>
            </stateMachine>
        </stateMachines>
    
        <linkStateMachines>
            <linkStateMachine>
                <initialStateMachine>BIG_BANG</initialStateMachine>
                <initialState>BIG_BANG_INIT</initialState>
                <finalStateMachine>AUTHORIZE</finalStateMachine>
                <finalState>AUTH_INIT</finalState>
            </linkStateMachine>
        </linkStateMachines>
    </stateMachineConfig>
    ]
}
```
```java
class TenantKeyValue {
    key: PLUGIN_PAYMENT_STATE_MACHINE_noop
    values: [<?xml version="1.0" encoding="UTF-8"?>
    
    <stateMachineConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:noNamespaceSchemaLocation="StateMachineConfig.xsd">
    
        <stateMachines>
            <stateMachine name="BIG_BANG">
                <states>
                    <state name="BIG_BANG_INIT"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>BIG_BANG_INIT</initialState>
                        <operation>OP_DUMMY</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>BIG_BANG_INIT</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_DUMMY"/>
                </operations>
            </stateMachine>
            <stateMachine name="AUTHORIZE">
                <states>
                    <state name="AUTH_INIT"/>
                    <state name="AUTH_SUCCESS"/>
                    <state name="AUTH_FAILED"/>
                    <state name="AUTH_ERRORED"/>
                </states>
                <transitions>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>SUCCESS</operationResult>
                        <finalState>AUTH_SUCCESS</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>FAILURE</operationResult>
                        <finalState>AUTH_FAILED</finalState>
                    </transition>
                    <transition>
                        <initialState>AUTH_INIT</initialState>
                        <operation>OP_AUTHORIZE</operation>
                        <operationResult>EXCEPTION</operationResult>
                        <finalState>AUTH_ERRORED</finalState>
                    </transition>
                </transitions>
                <operations>
                    <operation name="OP_AUTHORIZE"/>
                </operations>
            </stateMachine>
        </stateMachines>
    
        <linkStateMachines>
            <linkStateMachine>
                <initialStateMachine>BIG_BANG</initialStateMachine>
                <initialState>BIG_BANG_INIT</initialState>
                <finalStateMachine>AUTHORIZE</finalStateMachine>
                <finalState>AUTH_INIT</finalState>
            </linkStateMachine>
        </linkStateMachines>
    </stateMachineConfig>
    ]
}
```
```ruby
TODO
```
```python
{'key': 'PLUGIN_PAYMENT_STATE_MACHINE_demo_plugin', 'values': []}
```

**Query Parameters**

None.

**Returns**

Returns a tenant key value object.

### Delete a per tenant payment state machine for a plugin

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://localhost:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/demo_plugin"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String pluginName = "noop";

tenantApi.deletePluginPaymentStateMachineConfig(pluginName, requestOptions);
```

```ruby
TODO
```

```python
tenantApi = killbill.api.TenantApi()

plugin_name = 'demo_plugin'

tenantApi.delete_plugin_payment_state_machine_config(plugin_name, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
```
```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 204 http status without content.

## Tenant Key Values


We provide a mechanism to register `{key, value}` pairs for a given tenant. Such functionality
is used internally by the system to keep track of all the per-tenant configuration, from catalog, system properties, plugin configuration.

However, one can add *user* keys as well to keep track of per-specific mapping information. For example some global setting that would be accessible
for all plugins could be stored here.

### Add a per tenant user key/value

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: text/plain" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d "demo_value" \
    "http://localhost:8080/1.0/kb/tenants/userKeyValue/demo_value"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String keyName = "demo_value";
String body = "demo_value";
TenantKeyValue result = tenantApi.insertUserKeyValue(keyName, body, requestOptions);
```

```ruby
user = "demo"
reason = nil
comment = nil

key_name = "demo_value"
key_value = "demo_value"

KillBillClient::Model::Tenant.upload_tenant_user_key_value(key_name, 
                                                           key_value, 
                                                           user, 
                                                           reason, 
                                                           comment, 
                                                           options)
```

```python
tenantApi = killbill.api.TenantApi()

key_name = 'demo_value'
body = 'demo_value'

tenantApi.insert_user_key_value(key_name, body, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://localhost:8080/1.0/kb/tenants/userKeyValue/demo_value
< Content-Type: application/json
< Content-Length: 0
```
```java
class TenantKeyValue {
    key: demo_value
    values: [demo_value]
}
```
```ruby
{
   "key":"demo_value",
   "values":[
      "demo_value"
   ]
}
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 201 http status without content.

### Retrieve a per tenant user key/value

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/tenants/userKeyValue/demo_value"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String keyName = "demo_value";

TenantKeyValue result = tenantApi.getUserKeyValue(keyName, requestOptions);
```

```ruby
key_name = "demo_value"

KillBillClient::Model::Tenant.get_tenant_user_key_value(key_name, options)
```

```python
tenantApi = killbill.api.TenantApi()

key_name = 'demo_value'

tenantApi.get_user_key_value(key_name)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

{
  "key": "demo_value",
  "values": [
    "demo_value",
    "demo_value"
  ]
}
```
```java
class TenantKeyValue {
    key: demo_value
    values: [demo_value]
}
```
```ruby
{
   "key":"demo_value",
   "values":[
      "demo_value"
   ]
}
```
```python
{'key': 'demo_value', 'values': []}
```

**Query Parameters**

None.

**Returns**

Returns a tenant key value object.

### Delete a per tenant user key/value

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://localhost:8080/1.0/kb/tenants/userKeyValue/demo_value"
```

```java
import org.killbill.billing.client.api.gen.TenantApi;
protected AdminApi tenantApi;

String keyName = "demo_value";

tenantApi.deleteUserKeyValue(keyName, requestOptions);
```

```ruby
user = "demo"
reason = nil
comment = nil
key_value = "demo_value"

KillBillClient::Model::Tenant.delete_tenant_user_key_value(key_value, 
                                                           user,
                                                           reason, 
                                                           comment, 
                                                           options)
```

```python
tenantApi = killbill.api.TenantApi()

key_name = 'demo_value'

tenantApi.delete_user_key_value(key_name, created_by='demo')
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
```
```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None.

**Returns**

A 204 http status without content.
