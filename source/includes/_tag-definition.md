# Tag Definition

These APIs manage a tag definition resource object, which provides the definition for a user-defined tag.

## Tag Definition Resource

Each tag is associated with a specific tag definition. A tag definition is a schema or template, and a tag is an instance of it. Please refer to the section [AccountTags](https://killbill.github.io/slate/#account-tags) for an overview of tags. The system provides some `System tag definitions` that can be used to add tags to a particular object. Users may define their own tags; however, when using `User Tags`, one must first create the associated tag definition.

The tag definition resource includes the following attributes:
* **`id`** <span style="color:#32A9C7">*[System generated, immutable]*</span>: The id for the resource, in UUID format.
* **`isControlTag`** <span style="color:#32A9C7">*[System generated, immutable]*</span>: Indicates if this is a control tag (true or false).
* **`name`** <span style="color:#32A9C7">*[User generated, immutable]*</span>: The name of the tag definition.
* **`description`** <span style="color:#32A9C7">*[User generated, immutable]*</span>: A description of the tag definition.
* **`applicableObjectTypes`** <span style="color:#32A9C7">*[User generated, immutable]*</span>: An array giving the name(s) of resource types that can be given this tag.


The APIs described below provide the ability to create, retrieve, and delete tag definitions, and also to access their associated audit logs.



## Tag Definition

This endpoint is used to create a new tag definition.

### Create a tag definition

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/tagDefinitions`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d '{ "name": "good_customer", "description": "a good customer", "applicableObjectTypes": ["ACCOUNT"]}' \
    "http://127.0.0.1:8080/1.0/kb/tagDefinitions"
```



```java
```

```ruby
```

```python

```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 
< Location: http://127.0.0.1:8080/1.0/kb/tagDefinitions/93f2bc59-e18d-4a5e-a645-9386c76fc03f
< Content-Type: application/json
< Content-Length: 0
```
```java
```
```ruby
```
```python
no content
```

**Returns**

Returns a status code of 201 without content to indicate success.

**Notes**

The `id` attribute is a string in UUID random format generated by the system. The `isControlTag` attribute will always be false.

The `CreatedBy` header may not be empty.

### List tag definitions

This endpoint is used to obtain a list of all tag definitions for this customer

**HTTP Request**

`GET http://127.0.0.1:8080/1.0/kb/tagDefinitions`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/tagDefinitions"
```

```java
```

```ruby
```

```python
```

> Example Response:

```shell
{
    "id": "93f2bc59-e18d-4a5e-a645-9386c76fc03f",
    "isControlTag": false,
    "name": "good_customer",
    "description": "a good customer",
    "applicableObjectTypes": [
      "ACCOUNT"
    ],
    "auditLogs": []
},
{
    "id": "00000000-0000-0000-0000-000000000001",
    "isControlTag": true,
    "name": "AUTO_PAY_OFF",
    "description": "Suspends payments until removed.",
    "applicableObjectTypes": [
      "ACCOUNT"
    ],
    "auditLogs": []
},
 ...
 
```
```java
```
```ruby
```
```python
```

**Query Parameters**

| Name | Type | Required | Description |
| ---- | -----| -------- | ----------- |
| **audit** | string | false | what audit log information to return (NONE, MINIMAL, FULL). Default NONE. |

**Returns**

Returns a list of tag definition objects and a status code of 200 to indicate success.


### Retrieve a tag definition by its ID

This endpoint is used to retrieve an existing tag definition.

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tagDefinitions/{tagDefinitionId}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/tagDefinitions/93f2bc59-e18d-4a5e-a645-9386c76fc03f"
```

```java
```

```ruby
```

```python
```

> Example Response:

```shell
{
    "id": "93f2bc59-e18d-4a5e-a645-9386c76fc03f",
    "isControlTag": false,
    "name": "good_customer",
    "description": "a good customer",
    "applicableObjectTypes": [
      "ACCOUNT"
    ],
    "auditLogs": []
}
```
```java
```
```ruby
```
```python
```

**Query Parameters**

| Name | Type | Required | Description |
| ---- | -----| -------- | ----------- |
| **audit** | string | false | what audit log information to return (NONE, MINIMAL, FULL). Default NONE. |

**Returns**

Returns a tag definition object and a status code of 200 to indicate success.


### Delete a tag definition

This endpoint is used to delete a tag definition.

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/tagDefinitions/{tagDefinitionId}`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    "http://127.0.0.1:8080/1.0/kb/tagDefinitions/93f2bc59-e18d-4a5e-a645-9386c76fc03f"
```

```java
```

```ruby
```

```python
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 
< Content-Type: application/json

```
```java
```
```ruby
```
```python
```

**Query Parameters**

None.

**Returns**

Returns a status code of 204 without content to indicate success.


## Audit Logs

### Retrieve tag definition audit logs with history by tag definition id

This endpoint is used to retrieve the full set of audit logs for a specified tag definition

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/tagDefinitions/{tagDefinitionId}/auditLogsWithHistory`

> Example Request:

```shell
curl \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/tagDefinitions/92991586-df8a-4d8d-9d55-61172c52fa45/auditLogsWithHistory"
```
> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

[
  {
    "changeType": "INSERT",
    "changeDate": "2019-02-26T01:56:48.000Z",
    "objectType": "TAG_DEFINITION",
    "objectId": "92991586-df8a-4d8d-9d55-61172c52fa45",
    "changedBy": "demo",
    "reasonCode": "demo",
    "comments": "demo",
    "userToken": "039f01ea-460a-4edd-bfbc-39a68149cad2",
    "history": {
      "id": null,
      "createdDate": "2019-02-26T01:56:48.000Z",
      "updatedDate": "2019-02-26T01:56:48.000Z",
      "recordId": 1,
      "accountRecordId": 1,
      "tenantRecordId": 1,
      "name": "good_customer",
      "applicableObjectTypes": "ACCOUNT",
      "description": "a good customer",
      "isActive": true,
      "tableName": "TAG_DEFINITIONS",
      "historyTableName": "TAG_DEFINITION_HISTORY"
    }
  }
]

```

**Query Parameters**

None.

**Returns**
    
Returns a list of tag definition audit logs with a status code of 200 to indicate success.
